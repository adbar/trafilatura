<text id="http://www.htservices.com/Tools/VBandC/SerialCommunications.htm" encoding="windows-1252">
<!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td background="../../_borders/WebSpiceBinaryWhite.gif">
<div style="border-style: ridge">
  <font color="#FFFFFF" face="Times New Roman">
  <a href="../../index.htm" target="_self">
<img border="0" src="../../16750_hightechlogo.gif" alt="High Tech Services is a systems integrators in North Carolina NC for industrial, laboratory, factory automation, controls, monitoring, quality and information systems" align="middle" width="150" height="150"></a></font>&nbsp;&nbsp;
  <a href="../../index.htm" target="_self">
  <img border="0" src="../../_borders/GoldHome.jpg" align="middle" alt="Home" width="113" height="30"></a>&nbsp;&nbsp;&nbsp;<a href="../../Products/index.htm" target="_self"><img border="0" src="../../_borders/GoldProducts.jpg" alt="Products" align="middle" width="113" height="30"></a>&nbsp;&nbsp;
  <a href="../../toc.htm" target="_self">
  <img border="0" src="../../_borders/GoldContents.jpg" align="middle" alt="Contents" width="113" height="30"></a>&nbsp;&nbsp;
  <a href="../../search.htm" target="_self">
  <img border="0" src="../../_borders/GoldSearch.jpg" align="middle" alt="Search" width="113" height="30"></a>&nbsp;&nbsp;
  <a href="../../contacts.htm" target="_self">
  <img border="0" src="../../_borders/GoldContacts.jpg" align="middle" alt="Contacts" width="113" height="30"></a></div>

</td></tr><!--msnavigation--></table><!--msnavigation--><table dir="ltr" border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td valign="top" width="1%" background="../../_borders/WebSpiceBinaryWhite.gif">
<p><a href="AspDotNet.htm" target="_self">
<img border="0" src="../../_borders/GoldAspNet.jpg" alt="ASP.NET asp dot net" width="113" height="30"></a></p>

<p><a href="../AutoId/index.htm" target="_self">
<img border="0" src="../../_borders/GoldBarCodes.jpg" alt="Bar Codes" width="113" height="30"></a></p>

<p><a href="../../Links/Books/index.htm" target="_self">
<img border="0" src="../../_borders/GoldBooks.jpg" alt="Books" width="113" height="30"></a></p>

<p><a href="index.htm" target="_self">
<img border="0" src="../../_borders/GoldCSharp.jpg" alt="C # sharp" width="113" height="30"></a></p>

<p><a target="_self" href="CENetPocketPC.htm">
<img border="0" src="../../_borders/GoldCeNet.jpg" alt="CE.NET Compact Framework" width="113" height="30"></a></p>

<p><a href="../IndustrialNetworking/index.htm" target="_self">
<img border="0" src="../../_borders/GoldCommunications.jpg" alt="Communications" width="113" height="30"></a></p>

<p><a href="../Computers/index.htm" target="_self">
<img border="0" src="../../_borders/GoldComputers.jpg" alt="Computers" width="113" height="30"></a></p>

<p><a href="../control_engines.htm" target="_self">
<img border="0" src="../../_borders/GoldControlEngines.jpg" alt="Control Engines" width="113" height="30"></a></p>

<p><a href="../../Links/SignalConditioning/index.htm" target="_self">
<img border="0" src="../../_borders/GoldDataAcquisition.jpg" alt="Data Acquisition" width="113" height="30"></a></p>

<p><a href="../servers.htm" target="_self">
<img border="0" src="../../_borders/GoldDatabases.jpg" alt="Databases" width="113" height="30"></a></p>

<p><a href="../../Links/Enclosures/index.htm" target="_self">
<img border="0" src="../../_borders/GoldEnclosures.jpg" alt="Enclosures" width="113" height="30"></a></p>

<p><a href="../../Products/ErpFramework.htm" target="_self">
<img border="0" src="../../_borders/ErpFramework.jpg" alt="ERP Framework" width="113" height="30"></a></p>

<p><a href="../../Applications/FactoryAutomation/index.htm" target="_self">
<img border="0" src="../../_borders/GoldFactoryAutomation.jpg" alt="Factory Automation" width="113" height="30"></a></p>

<p><a href="../../history_of_technology.htm" target="_self">
<img border="0" src="../../_borders/GoldHistory.jpg" alt="History" width="113" height="30"></a></p>

<p><a href="../MachineVision/index.htm" target="_self">
<img border="0" src="../../_borders/GoldImageAnalysis.jpg" alt="Image Analysis" width="113" height="30"></a></p>

<p><a href="../../Services/SystemsArchitecture/index.htm" target="_self">
<img border="0" src="../../_borders/GoldInfrastructure.jpg" alt="Infrastructure" width="113" height="30"></a></p>

<p><a href="../../Links/SignalConditioning/index.htm" target="_self">
<img border="0" src="../../_borders/GoldInputsOutputs.jpg" alt="Inputs Outputs I/O" width="113" height="30"></a></p>

<p><a href="../MachineVision/index.htm" target="_self">
<img border="0" src="../../_borders/GoldMachineVision.jpg" alt="Machine Vision" width="113" height="30"></a></p>

<p><a href="../../Partners/AlliedAutomation/index.htm" target="_self">
<img border="0" src="../../_borders/GoldMechanicalMachineDesign.jpg" alt="mechanical &amp; machine design" width="113" height="30"></a></p>

<p><a href="../../Partners/EmpixImaging/index.htm" target="_self">
<img border="0" src="../../_borders/GoldMicroscopy.jpg" alt="microscopy" width="113" height="30"></a></p>

<p><a href="../../Links/index.htm" target="_self">
<img border="0" src="../../_borders/GoldMiscellaneous.jpg" alt="Miscellaneous" width="113" height="30"></a></p>

<p><a href="../MotionDrives/index.htm" target="_self">
<img border="0" src="../../_borders/GoldMotionControl.jpg" alt="Motion Control" width="113" height="30"></a></p>

<p><a href="../MotionDrives/index.htm" target="_self">
<img border="0" src="../../_borders/GoldMotorsDrives.jpg" alt="Motors &amp; Drives" width="113" height="30"></a></p>

<p><a href="NET.htm" target="_self">
<img border="0" src="../../_borders/GoldNet.jpg" alt=".NET" width="113" height="30"></a></p>

<p><a href="../IndustrialNetworking/index.htm" target="_self">
<img border="0" src="../../_borders/GoldNetworks.jpg" alt="Networks" width="113" height="30"></a></p>

<p><a href="OPC.htm" target="_self">
<img border="0" src="../../_borders/GoldOPC.jpg" alt="OPC OLE Process Control" width="113" height="30"></a></p>

<p><a href="../OperatorInterfaces/index.htm" target="_self">
<img border="0" src="../../_borders/GoldOperatorInterfaces.jpg" alt="Operator Interfaces" width="113" height="30"></a></p>

<p><a target="_self" href="CENetPocketPC.htm">
<img border="0" src="../../_borders/GoldPdaPocketPc.jpg" alt="PDA Pocket PC Windows Mobile" width="113" height="30"></a></p>

<p><a href="../Computers/index.htm" target="_self">
<img border="0" src="../../_borders/GoldPeripherals.jpg" alt="Peripherals" width="113" height="30"></a></p>

<p><a href="../../Applications/Process/index.htm" target="_self">
<img border="0" src="../../_borders/GoldProcessControl.jpg" alt="process control" width="113" height="30"></a></p>

<p><a href="../../Links/PowerGrounding/index.htm" target="_self">
<img border="0" src="../../_borders/GoldPowerGrounding.jpg" alt="Power &amp; Grounding" width="113" height="30"></a></p>

<p><a href="../../Products/index.htm" target="_self">
<img border="0" src="../../_borders/GoldProducts.jpg" alt="Products" width="113" height="30"></a></p>

<p><a href="../PLC/index.htm" target="_self">
<img border="0" src="../../_borders/GoldProgrammableControllers.jpg" alt="Programmable Controllers" width="113" height="30"></a></p>

<p><a href="../../Applications/QualityControl/index.htm" target="_self">
<img border="0" src="../../_borders/GoldQualityControl.jpg" alt="Quality Control" width="113" height="30"></a></p>

<p><a href="../AutoId/index.htm" target="_self">
<img border="0" src="../../_borders/GoldRFTags.jpg" alt="Radio Frequency RF Tags" width="113" height="30"></a></p>

<p><a href="../../Reference/index.htm" target="_self">
<img border="0" src="../../_borders/GoldReference.jpg" alt="Reference" width="113" height="30"></a></p>

<p><a href="../Robots/index.htm" target="_self">
<img border="0" src="../../_borders/GoldRobots.jpg" alt="Robots" width="113" height="30"></a></p>

<p><a href="../../Links/Safety/index.htm" target="_self">
<img border="0" src="../../_borders/GoldSafety.jpg" alt="Safety" width="113" height="30"></a></p>

<p><a href="../Scada/index.htm" target="_self">
<img border="0" src="../../_borders/GoldSCADA.jpg" alt="SCADA" width="113" height="30"></a></p>

<p><a href="../../Links/SignalConditioning/index.htm" target="_self">
<img border="0" src="../../_borders/GoldSignalConditioning.jpg" alt="Signal Conditioning" width="113" height="30"></a></p>

<p><a href="../control_engines.htm" target="_self">
<img border="0" src="../../_borders/GoldSoftPLCs.jpg" alt="Soft PLCs" width="113" height="30"></a></p>

<p><a href="../../Services/SystemsArchitecture/index.htm" target="_self">
<img border="0" src="../../_borders/GoldSystemsArchitecture.jpg" alt="Systems Architecture" width="113" height="30"></a></p>

<p><a href="../../Links/ToolsEquipment/index.htm" target="_self">
<img border="0" src="../../_borders/GoldToolsEquipment.jpg" alt="Tools &amp; Equipment" width="113" height="30"></a></p>

<p><a target="_self" href="Training.htm">
<img border="0" src="../../_borders/GoldTraining.jpg" alt="Training" width="113" height="30"></a></p>

<p><a href="../../Tutorials/index.htm" target="_self">
<img border="0" src="../../_borders/GoldTutorials.jpg" alt="Tutorials" width="113" height="30"></a></p>

<p><a href="../../Products/index.htm" target="_self">
<img border="0" src="../../_borders/VerticalApplications.jpg" alt="Vertical Applications" width="113" height="30"></a></p>

<p><a href="index.htm" target="_self">
<img border="0" src="../../_borders/GoldVisualBasic.jpg" alt="Visual basic" width="113" height="30"></a></p>

</td><td valign="top" width="24"></td><!--msnavigation--><td valign="top"><p align="center">&nbsp;</p>
      <h1 align="center">Visual Basic, VB, C# Serial Communications Example Tutorials
Source Code Programs</h1>
      <p>&nbsp;</p>
      <p><a target="_self" href="Training.htm">
      <img border="0" src="../../VBCTrainingCallout.gif" width="250" height="250" align="right"></a></p>
<p>Serial communications has lost a lot of importance over the last five to ten years.&nbsp; Now there are much higher speed and specialty
networks.&nbsp; However, there are still
plenty of devices in factory and laboratory automation that only have a serial interface.&nbsp; Hopefully this page
will help you understand what it takes to read and write devices using RS232,
RS422, and RS485.&nbsp;&nbsp;</p>
<p>Other resources include:</p>
<ul>
  <li><a href="../../Reference/AsciiCharacterCodes/index.htm" target="_self">ASCII character
    reference chart</a></li>
  <li><a href="../../Reference/Rs232Serial/index.htm" target="_self">RS232 pinout</a></li>
  <li><a href="../IndustrialNetworking/index.htm" target="_self">
    Industrial Networking &amp; Communications</a></li>
  <li><a href="../IndustrialNetworking/ComputerPlc.htm" target="_self">Computer - PLC 
  communications</a></li>
</ul>
<p align="right">
<img border="0" src="../../images/M1706small.jpg" alt="visual basic vb c# serial communications: rs232, rs422, rs485 training tutorials example source codes mscomm activex controls" width="100" height="100"></p>
<h2>Original RS232 standard</h2>
<p>The original RS232 standard was developed about 40 years ago and specifies
that the maximum baud rate is 19,200 and the maximum cable length is 50
feet.&nbsp; While that may have been good 20 years ago -- it's too short and
slow today!&nbsp; Although today's computers are clocked to support much higher
baud rates -- technically you need to be careful.&nbsp; You also need to be
careful about using long cable lengths.&nbsp; Many people have gotten 100 foot cables to work, the question is
reliability.&nbsp; If we are using good quality cable and connectors and have
error detection built into the protocol then we might go over the 19,200 and 50
foot limits.&nbsp; Errors will be detected and we'll know how much of a problem
it is.&nbsp; Otherwise we'll stick to the limits to minimize our risk or use
RS422 or RS485.&nbsp;&nbsp;</p>
<p>RS422 and RS485 use a balanced line approach that eliminates many problems
with RS232.&nbsp; For example Profibus is based on RS485 and Profibus runs
at speeds up to 12 Mbaud (625 times faster than 19,200 baud).&nbsp; The problems with RS422 and RS485 is that the set-up is more
difficult: you have to use more expensive cable (for proper impedance and
capacitance), properly terminate the ends of
the cables, set addresses, etc.&nbsp;&nbsp;But the advantages are longer cable
lengths, higher baud rates, and multiple devices share the same communication
network.&nbsp;&nbsp;</p>
<p>If you want to learn more about the RS232, RS422, and RS485&nbsp;
<a target="_blank" href="http://www.camiresearch.com/Data_Com_Basics/RS232_standard.html">click
here</a> and <a target="_blank" href="http://www.sangoma.com/signal.htm">click here</a>.&nbsp;&nbsp;</p>
<p>&nbsp;</p>
<h2>Resources Required</h2>
<p>It does not take much to run and test these examples:</p>
<ul>
  <li>One computer with two serial ports or two computers with one serial
    port&nbsp;each</li>
  <li>A serial cable (typically 9 pin female to 9 pin female) and null modem
    adapter&nbsp;(or null modem serial cable)</li>
  <li>If you want to test RS485 then you will need two or more RS485 converters&nbsp;</li>
</ul>
<p><a target="_blank" href="http://www.bb-elec.com">B&amp;B Electronics</a> and
<a target="_blank" href="http://www.blackbox.com">Black
Box</a> are two favorites for serial communications.&nbsp; These two websites 
also have tutorials about serial communications.&nbsp; B&amp;B Electronics products 
usually cost less but Black Box usually has higher quality.&nbsp; So for demos, 
training, testing purposes we typically use B&amp;B equipment.&nbsp; For actual 
installations we typically use Black Box.&nbsp; (We want to minimize risk and 
those calls in the middle of the night).&nbsp; In all fairness to B&amp;B 
Electronics, if you buy their products and all the separate options 
(isolation, surge protection, etc) that may be built-in to the Black Box 
equipment then you are at about the same price and quality 
as Black Box.&nbsp; You can
usually find serial cables, 9 and 25 pin connectors, null modem
adapters, tools, and gender changers at your local Radio Shack, computer store or order on-line.&nbsp;&nbsp;</p>
<p align="right">
<img border="0" src="../../images/MODEM3small.jpg" alt="visual basic vb C# serial communications: rs232, rs422, rs485 training tutorials example source codes mscomm activex controls" width="150" height="50"></p>
<h2>Connection problems</h2>
<p>There are typically three problems that you will experience while trying to
connect serial devices:</p>
<ol>
  <li><span style="font-weight: 400">25 pin or 9 pin connectors</li>
  <li>Male and female connectors and cables</li>
  <li>DCE and DTE</span></li>
</ol>
<p>The RS232 standard started out with a 25 pin connector.&nbsp; Most RS232
connectors today are 9 pins.&nbsp; Try to work
with 9 pin connectors when ever possible so convert 25 pin connectors to 9 pin
connectors using 25 pin to 9 pin adapters.&nbsp;&nbsp;</p>
<p>The second thing that will mess you up is whether the connectors are
male or female (pins or sockets).&nbsp; Therefore it helps to have an assortment
of gender changers (male to male, female to female).&nbsp; (Please -- no e-mails
-- I'm not making any of this up).&nbsp; Gender changers come
in both 9 pin and 25 pins.&nbsp; If you have changed everything from 25 pin to 9
pin then you won't need many 25 pin gender changers.&nbsp;&nbsp; </p>
<p>The third problem is DCE &amp; DTE.&nbsp; If two serial ports both
transmit on pin 2 and receive on pin 3 (i.e. they are both DTE) and you plug in a straight through
serial cable then you will transmit into the transmit pin
(not the receive pin) on the other end and the other device can't receive the 
data.&nbsp; That is what null modem adapters
are for.&nbsp; Null modem adapters swap the wire connections on pins 2 and 3
(and also the handshaking lines) so that the transmitter (pin 2) goes into the receiver (pin 3)
of the other device.&nbsp; During the design phase you could worry yourself about this or you could just carry null modem adapters to the
installation site with you.&nbsp; Plug in the serial cable.&nbsp; If it does not work then
insert the null modem adapter and then see if it works.&nbsp; Note that you can
buy serial cables either straight through or null modem (crossed).&nbsp;&nbsp;</p>
<p>Another trick to is to buy 9 pin RS232 to RJ45 (modular connector) adapters and then
use regular Ethernet cable to connect the adapters.&nbsp;&nbsp;</p>
<p>Most RS422 and RS485 connections are done using screw terminals.&nbsp;
Therefore you don't have to worry about gender changers and
adapters.&nbsp;&nbsp;</p>
<p align="right">&nbsp;</p>
<h2><b>Getting Started</b></h2>
<p>The first step is to get connected and test out all the low level stuff:
cables, serial port hardware, serial port drivers, interrupt conflicts,
etc.&nbsp; The best way to do this is to attach the serial cable between two
computers and run the HyperTerminal communications program that comes with
Microsoft Windows (Start, Programs, Accessories, Communications, HyperTerminal).&nbsp;
You run the HyperTerminal program on both computers and should be able to type
messages into the main text box and see them appear on the other computer.&nbsp;
You can also send text files from one computer to the other.&nbsp; You can create small
text files to send using Notepad.&nbsp; Just open Notepad type in some text and
save the file.&nbsp; Note that in HyperTerminal
you will have to specify the connection to be direct to COM1, COM2, ... whatever
serial port you plugged the cable into.&nbsp; We would initially set the
communications parameters (on both computers) to 9600 baud, no parity, 8 data
bits, 1 stop bit.&nbsp;&nbsp;</p>
<p>If this does not work then try the following:</p>
<ol>
  <li><span style="font-weight: 400">Try inserting the null modem adapter</li>
  <li>Check computer's setup to see that the serial port is enabled and what
    COM port (1, 2, 3, 4, ...) it is configured for (hint: COM1 is address 3F8
    hex and IRQ4, COM2 is address 2F8 hex and IRQ3, COM3 is address 3E8 hex and
    IRQ4, and COM4 is address 2E8 hex and IRQ3).&nbsp;&nbsp;</li>
  <li>Check to make sure that infrared (IR) communications is not enabled on
    that COM port</li>
  <li>Check to make sure that other devices are not interfering with that COM
    port and the interrupt is not being used.&nbsp; For example if you are
    trying to use COM1 and a modem is trying to use COM3 and you are both
    using interrupts then one or both programs will not function
    correctly.&nbsp;&nbsp;</span></li>
</ol>
      <p align="right">
      <img border="0" src="../../images/HACKR115small.jpg" alt="visual basic vb C# serial communications: rs232, rs422, rs485 training tutorials example source codes mscomm activex controls" width="100" height="114"></p>
      <h2>Handshaking</h2>
      <p>&quot;Handshaking&quot;, when talking about serial communications, is how one 
      device tells another device that it is ready to receive data.&nbsp; There 
      are several layers of handshaking.&nbsp; There are the Data Terminal Ready 
      (DTR) / Data Set Ready (DSR) lines that indicate the other device is 
      plugged in, powered up and is present.&nbsp; Then there is Request To Send 
      (RTS) / Clear To Send (CTS) which indicates that the receiver has room in 
      it's input buffer and is ready to accept data.&nbsp; Third, there is XON 
      and XOFF.&nbsp; XON and XOFF are a method that one device can use the 
      serial link to tell the other device to stop sending and then when to 
      start sending again.&nbsp; </p>
      <p>Suppose that there are two serial devices, A &amp; B.&nbsp; Let's say that 
      device A is a Pentium 4, 3 GHz with hyperthreading, lot's of memory and 
      doing very little work.&nbsp; It can transmit and receive very fast.&nbsp; 
      But device B is a special device with a CPU that is having to do a lot of 
      other things and find time for serial communications.&nbsp; Also, device B 
      might have a small receive buffer.&nbsp; So if device A were transmitting 
      to device B then device A could transfer data much faster than device B 
      could receive it.&nbsp; So device B would use handshaking to tell device A 
      when to stop sending and then when to restart.&nbsp; </p>
      <p>RTS/CTS are hardware and require wires to carry these signals between 
      devices.&nbsp; XON/XOFF are special characters sent over the serial link 
      and do not require additional wires.&nbsp; XOFF is the character CTRL-S 
      (ASCII code 19) and XON is the character CTRL-Q (ASCII code 17).&nbsp; For 
      example, if you connect two computers with a serial cable and are able to 
      type characters on one computer and see the characters appear on the other 
      computer -- press CRTL-S (XOFF) on one computer to stop communications.&nbsp; 
      Type on the other computer and you should see that the characters are not 
      transmitted.&nbsp; Once you press CTRL-Q (XON) the characters should show 
      up because they were held at the transmitting computer until XON was sent 
      by the receiving computer.&nbsp; </p>
      <p>What if one device requires hardware handshaking and the other device 
      can not supply it?&nbsp; You must &quot;jumper out&quot; the hardware handshaking 
      lines by wiring the RTS/CTS lines together and the DTR/DSR lines together.&nbsp; 
      Note that some serial ports that use DTR &amp; DSR also use Carrier Detect 
      (CD) and will want the CD line tied into the DTR and DSR lines.&nbsp; </p>
      <p>&nbsp;</p>
      <div style="border-style: solid; border-width: 2; padding-left: 4; padding-right: 4; padding-top: 1; padding-bottom: 1; background-image: url('../../_borders/GoldGradient.gif')">
      <h1 align="center">NOTE</h1>
      <p align="center">Visual Studio 2005 will include a new namespace called 
      &quot;Ports&quot; and a new class called &quot;SerialPort&quot;.&nbsp; Read all about it here:</p>
      <p align="center">
      <a href="http://msdn2.microsoft.com/library/tf8zk72w.aspx" target="none">
      http://msdn2.microsoft.com/library/tf8zk72w.aspx</a></p>
      <p align="center">VS 2005 is still in beta so you can download the beta 
      and play with it or wait till early in 2005 to get the released product.&nbsp; </p>
      </div>
      <p>&nbsp;</p>
      <p>&nbsp;</p>
      <h2>Writing Code</h2>
<p>Visual Basic 6 provides, free of charge, the MSComm control with Visual
Basic.&nbsp; This allows the programmer to quickly and easily configure the COMM
serial port and then read and write data.&nbsp;  </p>
<p>The .NET framework does NOT have a control built-in for serial communications!&nbsp; 
I guess us serial programmers just aren't cool enough for the developers of NET.&nbsp; 
Well those guys can take their serial ports and ... Oh wait a minute.&nbsp; In 
the
<a target="_blank" href="http://www.microsoft.com/downloads/details.aspx?FamilyId=08E3D5F8-033D-420B-A3B1-3074505C03F3&displaylang=en">101 VB.NET 
&amp; C# examples</a> that you download they wrote a serial port class and 
give you the source code to learn from!&nbsp; Cool.&nbsp; This class is 
essentially a wrapper (we forgot what the &quot;official term&quot; for wrapper is in 
.NET) 
for operating system API calls -- but very, very educational.&nbsp; Problem is 
that this example has some bugs in it.&nbsp; For an updated version, we suggest 
you check:&nbsp; </p>
<p><a target="_blank" href="http://www.codeworks.it/net/VBNetRs232.htm">Corrado Cavalli's serial 
communications source code at www.CodeWorks.it</a></p>
<p>We view Corrado's code as the best &quot;open source&quot; .NET serial communications 
source code because Corrado keeps updating it.&nbsp; </p>
<p>NOTE that you could use the old MSComm ActiveX control with .NET programs.&nbsp; 
However, this defeats the whole purpose of .NET managed code and XCOPY 
deployment since you would have to register the MSComm control on every computer 
you installed the software on (instead of simply copying the code).&nbsp; </p>
<p>As of April 2004, Corrado, in our humble opinion, is not done.&nbsp; So to 
fully understand everything, you will need to do a lot more reading:</p>
<p>
<a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/devio/base/communications_resources.asp">Microsoft Platform SDK on Device I/O</a></p>
<p>
<a target="_blank" href="http://support.microsoft.com/default.aspx?scid=kb;en-us;823179">Microsoft how to: Access Serial Ports and Parallel Ports by Using Microsoft 
Visual Basic .NET</a></p>
<p>
<a target="_blank" href="http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=075318CA-E4F1-4846-912C-B4ED37A1578B">Microsoft Example</a></p>
<p>
<a target="_blank" href="http://www.gotdotnet.com/Community/UserSamples/Details.aspx?SampleGuid=9dde5cf3-4842-4d4b-baa7-73e09c4d5890">Here is sample code on .NET managed serial control</a></p>
<p>
<a target="_blank" href="http://www.codeproject.com/dotnet/DotNetComPorts.asp">Serial 
Communications in .NET</a></p>
<p>
<a target="_blank" href="http://msdn.microsoft.com/msdnmag/issues/02/10/netserialcomm/">MSDN 
Magazine: Use P/Invoke to Develop a .NET Base Class Library for Serial Device 
Communications</a></p>
<p>
<a target="_blank" href="http://www.gotdotnet.com/Community/Workspaces/viewUploads.aspx?id=0a680784-1d84-4e0a-8a62-9dcbcf79e1fb">DBComm: DualBrain Serial Communications by Corey Smith</a></p>
<p>&nbsp;</p>
<p>For the smart readers that do not want to support, test, and debug your own 
serial port controls -- there are several companies that do for you -- however, 
you have to purchase the software.&nbsp; </p>
<p>Many companies sell old DLL and ActiveX controls.&nbsp;&nbsp;One we have used
for many years is <a target="_blank" href="http://www.gleaf.com">Greenleaf Software</a>.&nbsp;
They include in their ActiveX all kinds of terminal emulators and file transfer
protocols such as ZMODEM.&nbsp;&nbsp;But again these are not .NET managed code.&nbsp; </p>
<p>A great source for .NET serial communications is <a href="http://franson.biz/serialtools/" target="none">Franson.biz's 
Serial Tools</a> for only $30.&nbsp; These guys sell it for the .NET framework 
and the .NET compact framework.&nbsp; They also have some GPS components that 
would be really cool for us computer geeks to play around with.&nbsp; </p>
<p>Other sources of .NET serial communications is:</p>
<p>
<a target="_blank" href="http://www.componentscience.net/Elements/TransPort/">Component 
Science Transport.&nbsp; </a> </p>
<p><a target="_blank" href="http://www.sax.net/Framework/Communications/">Sax.NET Communications</a></p>
<p><a target="_blank" href="http://www.aftek-software.com/CommControl.htm">AFTek Software 
ComControl</a></p>
<p><a target="_blank" href="http://www.charonsoftware.com/net/communications/">Charon Software</a></p>
<p>&nbsp;</p>
<p>Other  sources of information on serial communications include:</p>
<p>Chapter 21 (only on CD-ROM) of
<a target="_blank" href="http://www.amazon.com/exec/obidos/ASIN/0672315904/hightechservi-20">Dan 
Appleman's Visual Basic Programmer's Guide to the Win32 API</a></p>
<p>
<a target="_blank" href="http://www.amazon.com/exec/obidos/ASIN/1890422274/hightechservi-20">Visual Basic Programmer's Guide to Serial Communications 3</a> by Richard Grier 
of www.Mabry.com</p>
      <p>&nbsp;</p>
      <p>&nbsp;</p>
      <h2><b>&quot;Poor Man's Serial Instant Messenger&quot;</b></h2>
<p>Now that you have HyperTerminal running correctly on both computers we will 
replace one of the HyperTerminal programs with our &quot;Poor Man's Serial Instant 
Messenger&quot; written in VB 6, VB.NET, and C#.&nbsp; Run this program on one of the
two computers with HyperTerminal running on the other computer.&nbsp; When this
works then run &quot;Poor Man's Serial Instant Messenger&quot; on both
computers.&nbsp;&nbsp;You should be able to enter a text message (string), click on the
&quot;Send&quot; button and the text is sent to, and displayed on the other computer.&nbsp;&nbsp;</p>
<p>To download the VB6 source code for the &quot;Poor Man's Serial Instant Messenger&quot;
<a href="../../Programs/Example13/PMIM.zip" target="_self">click here</a>.&nbsp;&nbsp;</p>
<p>To download the VB.NET source code for the &quot;Poor Man's Serial Instant Messenger&quot; click here 
(sorry -- not yet ready).&nbsp;&nbsp;</p>
<p>To download the C# source code for the &quot;Poor Man's Serial Instant Messenger&quot; click here 
(sorry -- not yet ready).&nbsp;&nbsp;</p>
<p>&nbsp;</p>
<h2><a name="Serial Analyzers" target="_self">Serial Analyzers</a></h2>
<p>How many times have you had two serial devices communicating and no one wants to give you
the protocol?&nbsp; Okay, maybe it's just us and a few other geeks.&nbsp; The way to reverse engineer the protocol is to use serial
analyzers. You can reverse engineer&nbsp;anything from huge old legacy systems to
new protocols.&nbsp; Several companies manufacture such devices:&nbsp;</p>
<ul>
  <li><a target="_blank" href="http://www.sinnovations.com/">http://www.sinnovations.com/</a>&nbsp;</li>
  <li><a target="_blank" href="http://www.angelfire.com/biz5/USDM/index.html">http://www.angelfire.com/biz5/USDM/index.html</a>&nbsp;</li>
  <li><a target="_blank" href="http://www.runmode.com/">http://www.runmode.com/</a>&nbsp;</li>
  <li>
  <a target="_blank" href="http://www.bb-elec.com/product.asp?sku=SPY32&dept_id=128">http://www.bb-elec.com/product.asp?sku=SPY32&amp;dept_id=128</a></li>
  <li>
  <a target="_blank" href="http://www.bb-elec.com/product.asp?sku=SIMPTERM&dept_id=128">http://www.bb-elec.com/product.asp?sku=SIMPTERM&amp;dept_id=128</a></li>
  <li>
  <a target="_blank" href="http://www.bb-elec.com/product.asp?sku=STAS32&dept_id=128">http://www.bb-elec.com/product.asp?sku=STAS32&amp;dept_id=128</a></li>
  <li>
  <a target="_blank" href="http://www.bb-elec.com/product.asp?sku=STASPY32&dept_id=128">http://www.bb-elec.com/product.asp?sku=STASPY32&amp;dept_id=128</a></li>
  <li><a target="_blank" href="http://www.greenleafsoftware.com/">http://www.greenleafsoftware.com</a></li>
</ul>
<p>These programs allow you to &quot;break-in&quot; between two devices and
record everything that they send back and forth. It takes a little time and
testing to relate specific communications strings to functions but once that is
complete, it is easy to duplicate the commands and messages in VB or C#. Writing your own serial
analyzer program is good practice and we hope we will write one in the future to
put on this website.&nbsp;&nbsp;</p>
<p align="right">
<img border="0" src="../../images/M3620small.jpg" alt="visual basic vb C# serial communications: rs232, rs422, rs485 training tutorials example source codes mscomm activex controls" width="100" height="98"></p>
<h2>Real-World Applications</h2>
<p>Once you have run all the previous tests successfully we are ready to get
into the real-world applications.&nbsp; Most serial applications involve talking
to some device with a manufacturer specified protocol.&nbsp; The first step is
to ask the manufacturer if they have an ActiveX, OCX, DLL, or similar software
that works with VB / C#.&nbsp; If they do and the price is reasonable then
we suggest you buy their communications control.&nbsp;&nbsp;</p>
<p>Another consideration is to buy software such as a
<a target="_blank" href="http://www.hallogram.com/barcodes/software/wedge/winwedge.html">WinWedge</a>.&nbsp;
Yes you can write your own (using the &quot;Poor Man's Serial Instant Messenger&quot;
as a starting point) but you
then have to support it which is a major pain.&nbsp;&nbsp;</p>
<p>Assuming the manufacturer does not have anything available (or it costs
too much money) then you will need to get
from the manufacturer the protocol that the device talks.&nbsp; If the
manufacturer does not want to give you the protocol then go back to the section
on <a href="#Serial Analyzers" target="_self">Analyzers</a>.&nbsp; There are two
general classes of operation:</p>
<ol>
  <li><span style="font-weight: 400">The device automatically sends you the data once every time period or
    test.&nbsp; For example once a second or at the end of every
    test.&nbsp;&nbsp;</li>
  <li>You have to poll the device to get it to send the data</span></li>
</ol>
<p>For the first case, it is very easy to write code to receive the data and put 
the value into a VB / C# variable for use
elsewhere in your program.&nbsp; In fact the &quot;Poor Man's Serial Instant
Messenger&quot; is a great start.&nbsp; The second option (polling) is more difficult
but we provide an example later.&nbsp;&nbsp;</p>
<p>The two items that determine the difficulty of implementing your own
protocol are the number of commands you
have to program and timing issues.&nbsp; Sending one command that returns one
command (set of values) from the device is simple.&nbsp; Having to program many commands with
different possible responses becomes challenging.&nbsp; A good example of this
is the many industrial &amp; factory automation protocols in use today such as
DF1 (Allen-Bradley), Modbus, and Profibus DP.&nbsp; There are a lot of commands
you can send to a device using these protocols and there are typically more than
one response you need to handle.&nbsp;&nbsp;</p>
<p>The other challenging problem can be timing.&nbsp; Many protocols have
timing requirements.&nbsp; For example you have a maximum time between
characters and messages.&nbsp; If you take longer than the maximum time, the
receiver has &quot;timed out&quot; and you have to start all over again.&nbsp;
Today's processors are fast enough that this is not usually a problem.&nbsp; But
if you are sending a single character, running code to figure out the next
character, then sending another character, etc. and having a communications
problem -- try building the entire character string in memory first and then
sending the entire string out the serial port at one time.&nbsp; This reduces
the time between characters.&nbsp;&nbsp;</p>
      <p>&nbsp;</p>
      <h2>Typical Protocols</h2>
<p>We will discuss two types of protocols: simple and complete.&nbsp; A
simple protocol would something like &quot;value&quot; and then a carriage return
&lt;CR&gt;.&nbsp; The carriage return &lt;CR&gt; denotes the end of the message.&nbsp; For example if you are reading values from a device and you get
the number 1 then is the actual value that the device is sending you 1, 10,
1000, or any other number that starts with one?&nbsp; When you receive the &lt;CR&gt; it denotes that all digits of
the value have been sent.&nbsp; So now the receiver gets a 1&lt;CR&gt;, 10&lt;CR&gt;, or
1000&lt;CR&gt;
and can tell that they have received all the digits and easily convert the
value.&nbsp;&nbsp;</p>
<p>Note that the &lt;CR&gt; serves another purpose.&nbsp; What happens if you look in 
your serial input buffer and it has a lot of data in it?&nbsp; How do you know 
where to start reading data?&nbsp; The trick is to start reading characters 
until you read a &lt;CR&gt;.&nbsp; Then throw all those previous characters away 
(since you don't know if they are a complete message or not).&nbsp; So the &lt;CR&gt; 
serves as both the start and the end of a message.&nbsp; </p>
<p>What if the device is sending multiple values, such as temperature and
pressure?&nbsp; Then the protocol might be 115,128CR.&nbsp; So now the receiver
starts reading a 1, then another 1, then a 5, then a comma, then a 1, 2, 8, and
finally a carriage return.&nbsp; The logic in the receiver says read the first
value until you reach a comma and then start reading the second value until you
reach the carriage return.&nbsp;&nbsp;</p>
<p>So far the simple protocol is great -- except what happens when the
temperature is 115 and the pressure is 128 but data is &quot;garbled&quot; in
the transmission (when a big 200 hp motor starts up) and the receiver receives
115,28&lt;CR&gt; and shuts down the process because the pressure dropped to 28 PSI?&nbsp;
How is the receiver to know when the data is not correct?&nbsp; That
is why &quot;complete&quot; protocols are used -- they have more error detection
built in.&nbsp;&nbsp;</p>
<p>What we call a &quot;complete&quot; protocol is one that typically has a
Start Of Text (STX), sender address, receiver address, number of data values,
the data being sent, End Of Text (ETX), checksum, and then requires some form of
acknowledgement from the receiver.&nbsp; This &quot;complete&quot; protocol
provides several things:</p>
<ol>
  <li><span style="font-weight: 400">On a network with more than two devices, it allows a sender to send a
    message to a specific device or broadcast to all devices ( for a broadcast
    message the receiver address = 255 or
    some other predefined value).&nbsp;&nbsp;</li>
  <li>The number of data values, (bytes or words) tells the receiver how many
    bytes of data should be received.&nbsp; Knowing the structure of the
    message and the number of bytes allows you to see that all bytes were
    received.&nbsp; For example if the first byte is STX, the second byte the
    sender, third byte the receiver, the fourth byte equals 10 for ten bytes of
    data, then the receiver knows that bytes five through 14 are data and that byte
    15 had better be the ETX character.&nbsp; If the fifteenth byte is
    not the ETX character then the receiver knows that it did not receive a
    correct message and returns a negative acknowledgement (NAK) to the
    sender.</li>
  <li>The receiver runs the checksum algorithm on the data received and
    compares the receiver's calculated checksum to the checksum sent by the
    sender.&nbsp; If the checksums are equal then the receiver assumes that good
    data was received.&nbsp;&nbsp;If the checksums are not equal then one or 
  more of the characters have been &quot;garbled&quot;.&nbsp; </li>
  <li>After all the checks are done on the receiver end, the receiver sends
    an ACK or NAK back to the sender to tell the sender the status.&nbsp; If the
    receiver returns a NAK then the
    sender usually resends the message.&nbsp; The other purpose of ACK / NAK is
    to tell if the receiver is still able to receive and respond to messages (the receiver has
    not failed).&nbsp;&nbsp;</span></li>
</ol>
      <p align="right">
      <img border="0" src="../../images/Network1.JPG" alt="visual basic vb C# serial communications: rs232, rs422, rs485 training tutorials example source codes mscomm activex controls" width="100" height="63"></p>
<h2>Serial Client &amp; Server Example Programs</h2>
<p>We have written client and server examples that implement some protocol
functionality.&nbsp; The protocol is:</p>
<p>STX, Number Variables,Variable1, Variable2, Variable3, Variable4, ETX</p>
<p>On the transmit (server) side it is simple to create the outgoing string
by simply concatenating the string.&nbsp; On the receiver (client) side we want
to read in a string of data values and then parse the string of data
values.&nbsp; To do this we create a simple two state machine.&nbsp; The first
state is &quot;Waiting for STX&quot; and the second state is called either
&quot;Reading Data Values&quot; or &quot;Waiting for ETX&quot;.&nbsp; So we wait
for a STX character to be received.&nbsp; When a STX character is received we
start &quot;recording&quot; the incoming characters.&nbsp; Then we stop
&quot;recording&quot; incoming characters when a ETX character is
received.&nbsp; Once the ETX character is received we send the
&quot;recorded&quot; string of data values to a parsing routine that picks out
the individual values.&nbsp; Then the receive cycle (state machine) starts over
waiting for STX.&nbsp;&nbsp;</p>
<p>This program is neat to try out using RS485.&nbsp; You have one server and
multiple clients all&nbsp; &quot;daisy-chained&quot; together and all the
clients receive the data sent from the server.&nbsp;&nbsp;However, this is a
pain to set-up and even we have better things to do.&nbsp;&nbsp;</p>
<p>To download the source code for this example <a href="../../Programs/Example14/Example14.zip" target="_self">click
here</a>.&nbsp;&nbsp;</p>
      <p>&nbsp;</p>
      <h2>Famous Automation Protocol Definitions</h2>
<ul>
  <li><a target="_blank" href="http://www.ab.com/manuals/cn/17706516.pdf">DF1 - Allen-Bradley 
  (Rockwell)</a></li>
  <li><a target="_blank" href="http://www.modicon.com/techpubs/toc7.html">Modbus</a></li>
</ul>
<p>If you want examples of how to write the A-B protocol we recommend that you 
purchase the <a href="Books/index.htm#Home Automation Basic" target="_self">Home Automation 
Basics book</a>.&nbsp;&nbsp;</p>
      <p>&nbsp;</p>
      <h2>RS422 &amp; RS485</h2>
<p>Most of the changes for RS422 and RS485 are in the hardware and
cabling.&nbsp; For example, you have to use special purpose, high quality cable
and connectors, terminating resistors, set addresses, etc.&nbsp; Usually there are not any changes in software.&nbsp; The only
change in software being with 2 wire RS485 you sometimes need to toggle one of the handshaking
lines to enable the transmitter.&nbsp; Some converters automatically do this for
you.&nbsp; For more information we would recommend:</p>
<ul>
  <li>
  <a target="_blank" href="http://www.bb-elec.com/tech_articles/rs422_485_app_note/table_of_contents.asp">B&amp;B
    Electronics RS422 &amp; RS485 Applications Notes</a>&nbsp;</li>
  <li>
  <a target="_blank" href="http://www.bb-elec.com/tech_articles/rs485_basics.asp">B&amp;B
    Electronics &quot;Basics of the RS485 standard&quot;</a>&nbsp;</li>
</ul>
      <p>&nbsp;</p>
      <h2>Tips &amp; Tricks</h2>
<ol>
  <li><span style="font-weight: 400">Use high quality cable and connectors in your installed applications.</li>
  <li>For long distances use repeaters to isolate and reamplify the
    signal.&nbsp;&nbsp;</li>
  <li>For distances over 50 feet or noisy environments convert RS232 signals
    to RS422, RS485, or fiber optics.&nbsp;&nbsp;</li>
  <li>When talking to multiple devices over a large distance, instead of
    having one communications cable running everywhere have two or more
    communications modules with separate and shorter cables.&nbsp;&nbsp;</li>
  <li>Boards, devices, and connectors that include built-in terminating resistors are preferred
    over those that do not provide such provisions.&nbsp; Trying to insert your
    own resistor across two points usually fails over time.&nbsp;&nbsp;</li>
  <li>Follow proper grounding methods.&nbsp; Use heavy gauge wire or special
    purpose grounding straps.&nbsp; We have been called out to many problems that
    were grounding problems.&nbsp;&nbsp;</li>
  <li>Use isolation as much as possible.&nbsp; Use isolation on the
    communications cable, on the incoming power, etc.&nbsp;&nbsp;</li>
  <li>If things don't seem to work right, slow the baud rate way down (9600
    baud or even slower) and try it again.&nbsp; If the problems go away then most
    likely you have noise, improper grounding, termination, cheap cable or
    connectors, etc.&nbsp;&nbsp;</li>
  <li>For cables that run outside the building for lightning protection you
    should use a full complement of surge protection such as fuses, gas
    discharge tubes, and semiconductor Transient Voltage Suppressor
    (TVS).&nbsp;&nbsp;</li>
  <li>Keep your communication cables away from all sources of noise.&nbsp; Do
    not run near fluorescent lights, AC power cables, DC power cables over 24
    VDC, large motors, variable frequency drives, etc.&nbsp; Best installation
    is putting communications cables in their own grounded conduit.&nbsp; If you
    must cross AC cables then do so at right angles.&nbsp;&nbsp;</li>
  <li>See
  <a target="_blank" href="http://www.bb-elec.com/protect_system/protect_serial_system.asp">B&amp;B
    Electronics article</a></span></li>
  <li>IF you can, when reading and writing to a device, group the data into
    large blocks of data.&nbsp; For example, if you need to read 20 temperatures
    from a PLC that are spread throughout the PLC memory, use PLC
    &quot;move&quot; commands to copy the temperatures to one continuous block
    of memory.&nbsp; Now your program doing the reading only needs one read
    command of twenty values instead of twenty read commands of one value.&nbsp;
    Overall system performance will be much faster.&nbsp;&nbsp;</li>
</ol>
      <p>&nbsp;</p>
<script src="http://rcm.amazon.com/e/cm?t=hightechservi-20&l=st1&search=serial%20communications&mode=books&p=15&o=1" type="text/JavaScript"></script><noscript>
<MAP NAME="boxmap"><AREA SHAPE="RECT" COORDS="7, 224, 96, 232" HREF="http://rcm.amazon.com/e/cm/privacy-policy.html?o=1" ><AREA COORDS="0,0,10000,10000" HREF="http://www.amazon.com/exec/obidos/redirect-home/hightechservi-20" ></MAP><img src="http://rcm-images.amazon.com/images/G/01/rcm/468x240.gif" width="468" height="240" border="0" usemap="#boxmap" alt="Shop at Amazon.com"></noscript>

<script src="http://rcm.amazon.com/e/cm?t=hightechservi-20&l=st1&search=.net%20visual%20basic%20c%23&mode=software&p=15&o=1" type="text/JavaScript"></script>


<noscript>

<MAP NAME="boxmap"><AREA SHAPE="RECT" COORDS="7, 224, 96, 232" HREF="http://rcm.amazon.com/e/cm/privacy-policy.html?o=1" ><AREA COORDS="0,0,10000,10000" HREF="http://www.amazon.com/exec/obidos/redirect-home/hightechservi-20" ></MAP><img src="http://rcm-images.amazon.com/images/G/01/rcm/468x240.gif" width="468" height="240" border="0" usemap="#boxmap" alt="Shop at Amazon.com"></noscript>
      <p>&nbsp;</p>
      <p>We try to offer a fair and balanced opinion on every 
                    page of our website.&nbsp; We would appreciate more 
      information from other  users to express their opinions which we will 
      then incorporate.&nbsp; If you have questions or comments please post them 
      on our message board (see button in left hand column) so that others can 
      read and benefit.&nbsp; </p>
      <p align="center">
      <img border="0" src="../../images/World1.JPG" alt="visual basic vb C# serial communications: rs232, rs422, rs485 training tutorials example source codes mscomm activex controls" width="100" height="69"> <!--msnavigation--></td></tr><!--msnavigation--></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td background="../../_borders/WebSpiceBinaryWhite.gif">
<div style="border-style: ridge">


<p align="center"><b><a href="../../LetUsHelp.htm" target="_self"><font size="4">Click here to find out how High 
Tech Services can help you&nbsp;implement this technology.&nbsp; </font> </a></b></p>


<p><b>Copyright © 1984-2005 
<strong>CompanyLongName</strong> HTS, Cary, Raleigh, RTP, North Carolina, NC.&nbsp; 
All Rights Reserved.&nbsp; All trademarks are the property of their owners.&nbsp;Prices 
and specifications subject to change without notice.&nbsp; </b></div>

<p></p>

</td></tr><!--msnavigation--></table>
</text>
